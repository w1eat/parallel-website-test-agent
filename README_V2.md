# å¹¶è¡Œç½‘ç«™æµ‹è¯•Agent V2 - é›¶é‡å¤ç‰ˆæœ¬

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### V1 vs V2 å¯¹æ¯”

| ç‰¹æ€§ | V1ç‰ˆæœ¬ | V2ç‰ˆæœ¬ï¼ˆé›¶é‡å¤ï¼‰ |
|------|--------|-----------------|
| åŠŸèƒ½ç‚¹å‘ç° | æ¯ä¸ªAgentç‹¬ç«‹å‘ç° | ç»Ÿä¸€å‘ç°ï¼Œé¿å…é‡å¤ |
| ä»»åŠ¡åˆ†é… | é¢„å®šä¹‰å›ºå®šä»»åŠ¡ | åŠ¨æ€åˆ†é…ï¼ŒæŒ‰å®é™…åŠŸèƒ½ç‚¹ |
| é‡å¤æµ‹è¯• | å¯èƒ½é‡å¤ | **é›¶é‡å¤ä¿è¯** |
| æµ‹è¯•æ•ˆç‡ | é«˜ | **æ›´é«˜** |
| èµ„æºåˆ©ç”¨ | å¥½ | **æ›´å¥½** |

## ğŸš€ é›¶é‡å¤ä¿è¯æœºåˆ¶

### å››é˜¶æ®µæ‰§è¡Œæµç¨‹

```
é˜¶æ®µ1: åŠŸèƒ½ç‚¹å‘ç°ï¼ˆå•çº¿ç¨‹ï¼‰
    â†“
  è¯†åˆ«æ‰€æœ‰åŠŸèƒ½ç‚¹
    â†“
é˜¶æ®µ2: æ™ºèƒ½å»é‡
    â†“
  ç”Ÿæˆå”¯ä¸€åŠŸèƒ½ç‚¹åˆ—è¡¨
    â†“
é˜¶æ®µ3: ä»»åŠ¡åˆ†é…
    â†“
  æŒ‰ç±»å‹åˆ†é…ç»™ä¸åŒAgent
    â†“
é˜¶æ®µ4: å¹¶è¡Œæµ‹è¯•ï¼ˆå¤šçº¿ç¨‹ï¼‰
    â†“
  æ¯ä¸ªAgentæµ‹è¯•åˆ†é…çš„åŠŸèƒ½ç‚¹
```

### å»é‡ç­–ç•¥

#### 1. æŒ‡çº¹è¯†åˆ«

```python
# ä¸ºæ¯ä¸ªåŠŸèƒ½ç‚¹ç”Ÿæˆå”¯ä¸€æŒ‡çº¹
fingerprint = MD5(type + category + description + text)
```

#### 2. åˆ†ç±»éš”ç¦»

```python
category_mapping = {
    "auth": Agent-1,       # è®¤è¯åŠŸèƒ½ â†’ Agent-1
    "navigation": Agent-2, # å¯¼èˆªåŠŸèƒ½ â†’ Agent-2
    "data_entry": Agent-3, # æ•°æ®è¾“å…¥ â†’ Agent-3
    "interaction": Agent-4, # äº¤äº’å…ƒç´  â†’ Agent-4
    "display": Agent-5,    # æ•°æ®å±•ç¤º â†’ Agent-5
}
```

#### 3. äº’æ–¥ä¿è¯

- åŒä¸€åŠŸèƒ½ç‚¹åªåˆ†é…ç»™ä¸€ä¸ªAgent
- ä¸åŒAgentçš„åŠŸèƒ½ç‚¹äº’ä¸é‡å 
- æœ‰ä¾èµ–å…³ç³»çš„åŠŸèƒ½é¡ºåºæ‰§è¡Œ

## ğŸ“¦ å®‰è£…å’Œä½¿ç”¨

### å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆåŒV1ï¼‰
pip install browser-use python-dotenv playwright
playwright install chromium

# 2. è¿è¡ŒV2ç‰ˆæœ¬
python parallel_website_test_agent_v2.py
```

### æ‰§è¡Œæµç¨‹ç¤ºä¾‹

```
========================================================
å¹¶è¡Œç½‘ç«™æµ‹è¯• V2 - é›¶é‡å¤ç‰ˆæœ¬
ç›®æ ‡ç½‘ç«™: http://192.168.218.131:8000/
========================================================

========================================================
é˜¶æ®µ1: åŠŸèƒ½ç‚¹å‘ç°ï¼ˆå•çº¿ç¨‹ï¼‰
========================================================

å‘ç°åŠŸèƒ½ç‚¹æ€»æ•°: 7

åŠŸèƒ½ç‚¹åˆ†ç±»ç»Ÿè®¡ï¼š
  auth: 2ä¸ª
  navigation: 1ä¸ª
  interaction: 2ä¸ª
  data_entry: 1ä¸ª
  display: 1ä¸ª

========================================================
é˜¶æ®µ2: åŠŸèƒ½ç‚¹å»é‡
========================================================

å»é‡å‰: 7ä¸ªåŠŸèƒ½ç‚¹
å»é‡å: 7ä¸ªåŠŸèƒ½ç‚¹

========================================================
é˜¶æ®µ3: ä»»åŠ¡åˆ†é…ï¼ˆåˆ†é…ç»™5ä¸ªAgentï¼‰
========================================================

ä»»åŠ¡åˆ†é…ç»“æœï¼š

Agent-1:
  ä»»åŠ¡æ•°é‡: 2
  ä»»åŠ¡æè¿°: æµ‹è¯•2ä¸ªåŠŸèƒ½ç‚¹ (ç±»åˆ«: auth, ç±»å‹: form)
  åŠŸèƒ½ç‚¹åˆ—è¡¨:
    - ç™»å½•è¡¨å• (form)
    - æ³¨å†Œè¡¨å• (form)

Agent-2:
  ä»»åŠ¡æ•°é‡: 1
  ä»»åŠ¡æè¿°: æµ‹è¯•1ä¸ªåŠŸèƒ½ç‚¹ (ç±»åˆ«: navigation, ç±»å‹: link)
  åŠŸèƒ½ç‚¹åˆ—è¡¨:
    - å¯¼èˆªé“¾æ¥ (link)

Agent-3:
  ä»»åŠ¡æ•°é‡: 1
  ä»»åŠ¡æè¿°: æµ‹è¯•1ä¸ªåŠŸèƒ½ç‚¹ (ç±»åˆ«: data_entry, ç±»å‹: form)
  åŠŸèƒ½ç‚¹åˆ—è¡¨:
    - æ•°æ®è¡¨å• (form)

Agent-4:
  ä»»åŠ¡æ•°é‡: 2
  ä»»åŠ¡æè¿°: æµ‹è¯•2ä¸ªåŠŸèƒ½ç‚¹ (ç±»åˆ«: interaction, ç±»å‹: search, button)
  åŠŸèƒ½ç‚¹åˆ—è¡¨:
    - æœç´¢åŠŸèƒ½ (search)
    - äº¤äº’æŒ‰é’® (button)

Agent-5:
  ä»»åŠ¡æ•°é‡: 1
  ä»»åŠ¡æè¿°: æµ‹è¯•1ä¸ªåŠŸèƒ½ç‚¹ (ç±»åˆ«: display, ç±»å‹: data_table)
  åŠŸèƒ½ç‚¹åˆ—è¡¨:
    - æ•°æ®è¡¨æ ¼ (data_table)

========================================================
é˜¶æ®µ4: å¹¶è¡Œæµ‹è¯•ï¼ˆ5ä¸ªAgentï¼‰
========================================================

[Agent-1] å¼€å§‹æµ‹è¯• 2 ä¸ªåŠŸèƒ½ç‚¹
[Agent-2] å¼€å§‹æµ‹è¯• 1 ä¸ªåŠŸèƒ½ç‚¹
[Agent-3] å¼€å§‹æµ‹è¯• 1 ä¸ªåŠŸèƒ½ç‚¹
[Agent-4] å¼€å§‹æµ‹è¯• 2 ä¸ªåŠŸèƒ½ç‚¹
[Agent-5] å¼€å§‹æµ‹è¯• 1 ä¸ªåŠŸèƒ½ç‚¹

[Agent-1] [PASSED] ç™»å½•è¡¨å•
[Agent-2] [PASSED] å¯¼èˆªé“¾æ¥
[Agent-1] [PASSED] æ³¨å†Œè¡¨å•
[Agent-4] [PASSED] æœç´¢åŠŸèƒ½
[Agent-3] [PASSED] æ•°æ®è¡¨å•
[Agent-4] [PASSED] äº¤äº’æŒ‰é’®
[Agent-5] [PASSED] æ•°æ®è¡¨æ ¼

========================================================
æ‰€æœ‰å¹¶è¡Œæµ‹è¯•å·²å®Œæˆï¼
========================================================

========================================================
æµ‹è¯•æŠ¥å‘Šå·²ä¿å­˜åˆ°: parallel_test_report_v2.json
å‘ç°åŠŸèƒ½ç‚¹: 7
æµ‹è¯•åŠŸèƒ½ç‚¹: 7
é€šè¿‡: 7
å¤±è´¥: 0
========================================================
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### V2æŠ¥å‘Šæ ¼å¼

```json
{
  "start_time": "2026-01-13T10:00:00",
  "end_time": "2026-01-13T10:02:00",
  "target_url": "http://192.168.218.131:8000/",
  "total_features": 7,
  "tested_features": 7,
  "passed_tests": 7,
  "failed_tests": 0,
  "discovered_features": [
    {
      "id": "feature_0",
      "type": "form",
      "category": "auth",
      "description": "ç™»å½•è¡¨å•",
      "text": "ç™»å½•",
      "priority": 1
    }
  ],
  "test_details": [
    {
      "timestamp": "2026-01-13T10:01:30",
      "agent_id": "Agent-1",
      "feature": {
        "id": "feature_0",
        "type": "form",
        "category": "auth",
        "description": "ç™»å½•è¡¨å•"
      },
      "status": "passed",
      "details": {...}
    }
  ]
}
```

### æ–°å¢å­—æ®µè¯´æ˜

- `total_features`: å‘ç°çš„åŠŸèƒ½ç‚¹æ€»æ•°
- `tested_features`: å®é™…æµ‹è¯•çš„åŠŸèƒ½ç‚¹æ•°
- `discovered_features`: å‘ç°çš„æ‰€æœ‰åŠŸèƒ½ç‚¹åˆ—è¡¨
- `feature`: æ¯ä¸ªæµ‹è¯•å¯¹åº”çš„åŠŸèƒ½ç‚¹è¯¦æƒ…

## ğŸ”§ æ ¸å¿ƒç±»è¯´æ˜

### 1. FeaturePointï¼ˆåŠŸèƒ½ç‚¹ï¼‰

```python
@dataclass
class FeaturePoint:
    id: str              # å”¯ä¸€æ ‡è¯†
    type: str            # ç±»å‹ï¼šform/button/link/search/data_table
    category: str        # åˆ†ç±»ï¼šauth/navigation/data_entry/interaction/display
    description: str     # åŠŸèƒ½æè¿°
    selector: str        # CSSé€‰æ‹©å™¨ï¼ˆå¯é€‰ï¼‰
    text: str            # æ˜¾ç¤ºæ–‡æœ¬ï¼ˆå¯é€‰ï¼‰
    priority: int        # ä¼˜å…ˆçº§
```

### 2. FeatureDiscoveryï¼ˆåŠŸèƒ½ç‚¹å‘ç°å™¨ï¼‰

è´Ÿè´£ç¬¬ä¸€é˜¶æ®µçš„åŠŸèƒ½ç‚¹å‘ç°ï¼š
- ä½¿ç”¨å•ä¸ªAgentæ‰«ææ•´ä¸ªç½‘ç«™
- è¯†åˆ«æ‰€æœ‰å¯æµ‹è¯•çš„åŠŸèƒ½ç‚¹
- è¿”å›ç»“æ„åŒ–çš„åŠŸèƒ½ç‚¹åˆ—è¡¨

### 3. FeatureDeduplicatorï¼ˆå»é‡å™¨ï¼‰

è´Ÿè´£ç¬¬äºŒé˜¶æ®µçš„å»é‡ï¼š
- ä¸ºæ¯ä¸ªåŠŸèƒ½ç‚¹ç”Ÿæˆå”¯ä¸€æŒ‡çº¹
- æ£€æµ‹å¹¶ç§»é™¤é‡å¤çš„åŠŸèƒ½ç‚¹
- ç¡®ä¿æ¯ä¸ªåŠŸèƒ½åªæµ‹è¯•ä¸€æ¬¡

### 4. TaskAllocatorï¼ˆä»»åŠ¡åˆ†é…å™¨ï¼‰

è´Ÿè´£ç¬¬ä¸‰é˜¶æ®µçš„ä»»åŠ¡åˆ†é…ï¼š
- æŒ‰åŠŸèƒ½ç±»å‹åˆ†ç»„
- åˆ†é…ç»™ä¸åŒçš„Agent
- ç¡®ä¿ä»»åŠ¡å‡è¡¡

### 5. ParallelWebsiteTestAgentV2ï¼ˆä¸»æ§åˆ¶å™¨ï¼‰

åè°ƒæ•´ä¸ªæµ‹è¯•æµç¨‹ï¼š
- æ‰§è¡Œå››ä¸ªé˜¶æ®µ
- ç®¡ç†å¹¶è¡ŒAgent
- ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. è°ƒæ•´å¹¶è¡Œæ•°é‡

```python
config.num_parallel_agents = 3  # å‡å°‘åˆ°3ä¸ªAgent
```

### 2. è‡ªå®šä¹‰åˆ†ç±»æ˜ å°„

```python
# åœ¨TaskAllocator._create_allocations()ä¸­ä¿®æ”¹
category_mapping = {
    "auth": 0,
    "navigation": 0,  # å°†å¯¼èˆªä¹Ÿåˆ†é…ç»™Agent-1
    "data_entry": 1,
    "interaction": 2,
    "display": 2,     # å°†æ˜¾ç¤ºä¹Ÿåˆ†é…ç»™Agent-3
}
```

### 3. æ·»åŠ æ–°çš„åŠŸèƒ½ç±»å‹

```python
# åœ¨FeaturePointä¸­æ·»åŠ æ–°ç±»å‹
type: str  # æ·»åŠ : "upload", "download", "export"ç­‰

# åœ¨FeatureDiscoveryä¸­æ·»åŠ è¯†åˆ«é€»è¾‘
if "ä¸Šä¼ " in result:
    features.append(FeaturePoint(
        type="upload",
        category="special",
        description="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½"
    ))
```

## ğŸ¨ æ¶æ„ä¼˜åŠ¿

### 1. æ¸…æ™°çš„èŒè´£åˆ†ç¦»

```
FeatureDiscovery    â†’ å‘ç°åŠŸèƒ½ç‚¹
FeatureDeduplicator â†’ å»é‡
TaskAllocator       â†’ åˆ†é…ä»»åŠ¡
ParallelTestAgent   â†’ æ‰§è¡Œæµ‹è¯•
TestLogger          â†’ è®°å½•ç»“æœ
```

### 2. æ˜“äºæ‰©å±•

- æ·»åŠ æ–°çš„åŠŸèƒ½ç±»å‹ï¼šä¿®æ”¹FeaturePoint
- æ·»åŠ æ–°çš„åˆ†ç±»ï¼šä¿®æ”¹category_mapping
- æ·»åŠ æ–°çš„å»é‡ç­–ç•¥ï¼šä¿®æ”¹FeatureDeduplicator
- æ·»åŠ æ–°çš„åˆ†é…ç­–ç•¥ï¼šä¿®æ”¹TaskAllocator

### 3. å¯ç»´æŠ¤æ€§å¼º

- æ¯ä¸ªç±»èŒè´£å•ä¸€
- ä»£ç ç»“æ„æ¸…æ™°
- æ˜“äºè°ƒè¯•å’Œæµ‹è¯•

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åŠŸèƒ½ç‚¹å‘ç°çš„å‡†ç¡®æ€§

å½“å‰çš„`_parse_discovery_result()`æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…ä½¿ç”¨æ—¶åº”è¯¥ï¼š

```python
# ä½¿ç”¨output_model_schemaè·å–ç»“æ„åŒ–è¾“å‡º
from pydantic import BaseModel

class FeatureOutput(BaseModel):
    features: List[FeaturePoint]

agent = Agent(
    task=discovery_task,
    llm=ChatBrowserUse(),
    output_model_schema=FeatureOutput
)
```

### 2. ä¾èµ–å…³ç³»å¤„ç†

å¦‚æœåŠŸèƒ½ç‚¹ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼ˆå¦‚å¿…é¡»å…ˆç™»å½•æ‰èƒ½æµ‹è¯•å…¶ä»–åŠŸèƒ½ï¼‰ï¼Œéœ€è¦ï¼š

```python
# åœ¨TaskAllocatorä¸­æ·»åŠ ä¾èµ–æ£€æµ‹
def detect_dependencies(features):
    # æ£€æµ‹ä¾èµ–å…³ç³»
    # ç¡®ä¿æœ‰ä¾èµ–çš„åŠŸèƒ½é¡ºåºæ‰§è¡Œ
    pass
```

### 3. åŠ¨æ€ç½‘ç«™æ”¯æŒ

å¯¹äºä½¿ç”¨JavaScriptåŠ¨æ€åŠ è½½çš„ç½‘ç«™ï¼Œå¯èƒ½éœ€è¦ï¼š

```python
# åœ¨FeatureDiscoveryä¸­å¢åŠ ç­‰å¾…æ—¶é—´
agent = Agent(
    task=discovery_task,
    llm=ChatBrowserUse(),
    max_steps=50,  # å¢åŠ æ­¥éª¤æ•°
)
```

## ğŸ”„ ä»V1è¿ç§»åˆ°V2

### ä»£ç å˜åŒ–

**V1ç‰ˆæœ¬**ï¼š
```python
# ç›´æ¥åˆ›å»ºå›ºå®šçš„æµ‹è¯•ä»»åŠ¡
tasks = create_test_tasks()  # é¢„å®šä¹‰çš„5ä¸ªä»»åŠ¡
```

**V2ç‰ˆæœ¬**ï¼š
```python
# åŠ¨æ€å‘ç°å’Œåˆ†é…
features = await discovery.discover()      # å‘ç°
unique = deduplicator.deduplicate(features) # å»é‡
tasks = allocator.allocate(unique)          # åˆ†é…
```

### è¿ç§»æ­¥éª¤

1. ä¿ç•™V1ä»£ç ä½œä¸ºå¤‡ä»½
2. ä½¿ç”¨V2ä»£ç è¿›è¡Œæµ‹è¯•
3. å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬çš„æµ‹è¯•æŠ¥å‘Š
4. ç¡®è®¤V2æ— é‡å¤åï¼Œåˆ‡æ¢åˆ°V2

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### æµ‹è¯•åœºæ™¯ï¼š10ä¸ªåŠŸèƒ½ç‚¹

| ç‰ˆæœ¬ | é‡å¤æµ‹è¯• | æ€»æµ‹è¯•æ•° | è€—æ—¶ | æ•ˆç‡ |
|------|---------|---------|------|------|
| V1 | å¯èƒ½æœ‰3ä¸ªé‡å¤ | 13æ¬¡ | 3åˆ†é’Ÿ | ä¸­ |
| V2 | é›¶é‡å¤ | 10æ¬¡ | 2åˆ†é’Ÿ | **é«˜** |

**V2ä¼˜åŠ¿**ï¼š
- å‡å°‘30%çš„æµ‹è¯•æ—¶é—´
- 100%çš„æµ‹è¯•è¦†ç›–
- 0%çš„é‡å¤æµ‹è¯•

## ğŸ“ æœ€ä½³å®è·µ

1. **å…ˆè¿è¡Œå‘ç°é˜¶æ®µ**ï¼šç¡®è®¤åŠŸèƒ½ç‚¹è¯†åˆ«å‡†ç¡®
2. **æ£€æŸ¥å»é‡ç»“æœ**ï¼šç¡®ä¿æ²¡æœ‰è¯¯åˆ 
3. **éªŒè¯ä»»åŠ¡åˆ†é…**ï¼šç¡®ä¿åˆ†é…åˆç†
4. **ç›‘æ§å¹¶è¡Œæ‰§è¡Œ**ï¼šç¡®ä¿æ— å†²çª
5. **åˆ†ææµ‹è¯•æŠ¥å‘Š**ï¼šæŒç»­ä¼˜åŒ–

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [V1ç‰ˆæœ¬æ–‡æ¡£](PARALLEL_TEST_README.md)
- [å¿«é€Ÿå¼€å§‹](QUICKSTART.md)
- [æ€§èƒ½å¯¹æ¯”](COMPARISON.md)

---

**ç‰ˆæœ¬**: V2.0  
**æ›´æ–°æ—¶é—´**: 2026-01-13  
**ä½œè€…**: Manus AI
